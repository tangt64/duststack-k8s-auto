- name: prepare helm YAML files to the first master node
  copy:
    src: "{{ item }}"
    dest: /tmp/
  with_items:
    - helm.sh
    - rbac-config.yaml

- name: prepare helm package manager
  shell: sh /tmp/helm.sh

- name: create service account tiller
  command: kubectl create -f /tmp/rbac-config.yaml

- name: edit clusterrolebind permissive-binding
  command: kubectl create clusterrolebinding permissive-binding --clusterrole=cluster-admin --user=admin --user=kubelet --group=system:serviceaccounts

- name: update to helm repository
  command: helm repo update

#- name: deploy kubernetes metrics service
#  command: helm install --name metrics-server stable/metrics-server  --namespace metrics --set args={"--kubelet-insecure-tls=true,--kubelet-preferred-address-types=InternalIP\,Hostname\,ExternalIP"}
